<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>QARTOD Examples &mdash; qartod 0.0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="qartod 0.0.2 documentation" href="../index.html" />
    <link rel="up" title="IOOS QARTOD Examples" href="index.html" />
    <link rel="next" title="IOOS QARTOD Code Documentation" href="../code/index.html" />
    <link rel="prev" title="IOOS QARTOD Examples" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="qartod-examples">
<h1>QARTOD Examples<a class="headerlink" href="#qartod-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="notebook-setup">
<h2>Notebook Setup<a class="headerlink" href="#notebook-setup" title="Permalink to this headline">¶</a></h2>
<p>First, I include some modules that make it easier to write notebooks. It
just wraps some plotting stuff for me so I don&#8217;t have to paste it into
every notebook.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/Users/lcampbell/Notebooks/toolkit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oceansmap</span> <span class="k">import</span> <span class="n">plotting</span>
<span class="kn">from</span> <span class="nn">oceansmap</span> <span class="k">import</span> <span class="n">opendap</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">lcampbell</span><span class="o">/.</span><span class="n">virtualenvs</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">numexpr</span><span class="o">/</span><span class="n">cpuinfo</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">2</span><span class="p">]</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
  <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">netCDF4</span> <span class="k">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">num2date</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://sos.maracoos.org/stable/dodsC/hrecos/HRWSTPTH/HRWSTPTH_2016-08-17.nc&#39;</span>
<span class="n">nc</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="n">opendap</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="nb">print</span> <span class="s2">&quot;&quot;</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">opendap</span><span class="o">.</span><span class="n">get_geophysical_variables</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
    <span class="n">pretty_name</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">pretty_name</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">{:60}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pretty_name</span><span class="p">,</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">18</span><span class="n">T03</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mf">00.000006</span>

<span class="n">Mass</span> <span class="n">Concentration</span> <span class="n">Of</span> <span class="n">Oxygen</span> <span class="n">In</span> <span class="n">Sea</span> <span class="n">Water</span> <span class="p">(</span><span class="n">kg</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>          <span class="p">:</span> <span class="mf">0.00596999982372</span> <span class="n">kg</span> <span class="n">m</span><span class="o">-</span><span class="mi">3</span>
<span class="n">Sea</span> <span class="n">Water</span> <span class="n">Ph</span> <span class="n">Reported</span> <span class="n">On</span> <span class="n">Total</span> <span class="n">Scale</span> <span class="p">(</span><span class="n">pH</span><span class="p">)</span>                   <span class="p">:</span> <span class="mf">7.57999992371</span> <span class="n">pH</span>
<span class="n">Water</span> <span class="n">Surface</span> <span class="n">Height</span> <span class="n">Above</span> <span class="n">Reference</span> <span class="n">Datum</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>              <span class="p">:</span> <span class="mf">0.0</span> <span class="n">m</span>
<span class="n">Sea</span> <span class="n">Water</span> <span class="n">Turbidity</span> <span class="p">(</span><span class="n">NTU</span><span class="p">)</span>                                   <span class="p">:</span> <span class="mf">28.5</span> <span class="n">NTU</span>
<span class="n">Sea</span> <span class="n">Water</span> <span class="n">Electrical</span> <span class="n">Conductivity</span> <span class="p">(</span><span class="n">S</span> <span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>                   <span class="p">:</span> <span class="mf">0.319599986076</span> <span class="n">S</span> <span class="n">m</span><span class="o">-</span><span class="mi">1</span>
<span class="n">Sea</span> <span class="n">Water</span> <span class="n">Temperature</span> <span class="p">(</span><span class="n">degrees_C</span><span class="p">)</span>                           <span class="p">:</span> <span class="mf">28.0900001526</span> <span class="n">degrees_C</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plotting</span><span class="o">.</span><span class="n">easy_plot</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="s1">&#39;sea_water_temperature&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/QARTOD-Examples_7_1.png" src="../_images/QARTOD-Examples_7_1.png" />
<div class="section" id="let-s-do-some-qc">
<h3>Let&#8217;s do some QC!<a class="headerlink" href="#let-s-do-some-qc" title="Permalink to this headline">¶</a></h3>
<div class="section" id="range-check">
<h4>Range Check<a class="headerlink" href="#range-check" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ioos_qartod.qc_tests</span> <span class="k">import</span> <span class="n">qc</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">sensor_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">user_range</span>   <span class="o">=</span> <span class="p">(</span><span class="mf">27.95</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">range_check</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="n">range_check</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">ioos_qartod</span><span class="o">.</span><span class="n">qc_tests</span><span class="o">.</span><span class="n">qc</span><span class="p">:</span>

<span class="n">range_check</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">sensor_span</span><span class="p">,</span> <span class="n">user_span</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">Given</span> <span class="n">a</span> <span class="mi">2</span><span class="o">-</span><span class="nb">tuple</span> <span class="n">of</span> <span class="n">sensor</span> <span class="n">minimum</span><span class="o">/</span><span class="n">maximum</span> <span class="n">values</span><span class="p">,</span> <span class="n">flag</span> <span class="n">data</span> <span class="n">outside</span> <span class="n">of</span>
    <span class="nb">range</span> <span class="k">as</span> <span class="n">bad</span> <span class="n">data</span><span class="o">.</span>  <span class="n">Optionally</span> <span class="n">also</span> <span class="n">flag</span> <span class="n">data</span> <span class="n">which</span> <span class="n">falls</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">a</span> <span class="n">user</span>
    <span class="n">defined</span> <span class="nb">range</span><span class="o">.</span>

    <span class="p">:</span><span class="n">param</span> <span class="n">arr</span><span class="p">:</span> <span class="n">An</span> <span class="n">array</span> <span class="n">of</span> <span class="n">data</span>
    <span class="p">:</span><span class="n">param</span> <span class="n">sensor_span</span><span class="p">:</span> <span class="n">A</span> <span class="mi">2</span><span class="o">-</span><span class="nb">tuple</span> <span class="n">consisting</span> <span class="n">of</span> <span class="n">the</span> <span class="n">sensor</span> <span class="n">limits</span><span class="o">.</span>  <span class="n">Data</span>
                        <span class="n">exceeding</span> <span class="n">this</span> <span class="n">threshold</span> <span class="n">will</span> <span class="n">be</span> <span class="n">flagged</span> <span class="k">as</span> <span class="n">bad</span>
    <span class="p">:</span><span class="n">param</span> <span class="n">user_span</span><span class="p">:</span> <span class="n">An</span> <span class="n">optional</span> <span class="mi">2</span><span class="o">-</span><span class="nb">tuple</span> <span class="n">consisting</span> <span class="n">of</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">data</span> <span class="n">bounds</span><span class="o">.</span> <span class="n">Data</span> <span class="n">outside</span> <span class="n">of</span> <span class="n">these</span> <span class="n">bounds</span> <span class="n">but</span> <span class="n">within</span> <span class="n">sensor</span> <span class="n">span</span> <span class="n">will</span>
                      <span class="n">be</span> <span class="n">flagged</span> <span class="k">as</span> <span class="n">suspect</span><span class="o">.</span>  <span class="n">If</span> <span class="n">the</span> <span class="n">parameter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">present</span> <span class="ow">or</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">then</span> <span class="n">onlyh</span> <span class="n">the</span> <span class="n">sensor_span</span> <span class="n">will</span> <span class="n">be</span> <span class="n">considered</span> <span class="ow">and</span> <span class="n">no</span> <span class="n">data</span> <span class="n">can</span> <span class="n">be</span> <span class="n">flagged</span> <span class="k">as</span> <span class="n">suspect</span><span class="o">.</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">qc_flags</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">range_check</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sea_water_temperature&#39;</span><span class="p">][:],</span> <span class="n">sensor_range</span><span class="p">,</span> <span class="n">user_range</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">num2date</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sea_water_temperature&#39;</span><span class="p">][:]</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotting</span><span class="o">.</span><span class="n">pretty_name</span><span class="p">(</span><span class="n">nc</span><span class="p">,</span> <span class="s1">&#39;sea_water_temperature&#39;</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sea Water Temperature Range Check 2016-08-17&quot;</span>
<span class="n">flagged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">qc_flags</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">make_qc_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flagged</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/QARTOD-Examples_13_1.png" src="../_images/QARTOD-Examples_13_1.png" />
</div>
<div class="section" id="spike-check">
<h4>Spike Check<a class="headerlink" href="#spike-check" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">low_thresh</span><span class="p">,</span> <span class="n">high_thresh</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">spike_check</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Help</span> <span class="n">on</span> <span class="n">function</span> <span class="n">spike_check</span> <span class="ow">in</span> <span class="n">module</span> <span class="n">ioos_qartod</span><span class="o">.</span><span class="n">qc_tests</span><span class="o">.</span><span class="n">qc</span><span class="p">:</span>

<span class="n">spike_check</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">low_thresh</span><span class="p">,</span> <span class="n">high_thresh</span><span class="p">,</span> <span class="n">prev_qc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">Determine</span> <span class="k">if</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">spike</span> <span class="n">at</span> <span class="n">data</span> <span class="n">point</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span> <span class="n">by</span> <span class="n">subtracting</span>
    <span class="n">the</span> <span class="n">midpoint</span> <span class="n">of</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">taking</span> <span class="n">the</span> <span class="n">absolute</span> <span class="n">value</span> <span class="n">of</span> <span class="n">this</span>
    <span class="n">quantity</span><span class="p">,</span> <span class="n">seeing</span> <span class="k">if</span> <span class="n">it</span> <span class="n">exceeds</span> <span class="n">a</span> <span class="n">a</span> <span class="n">low</span> <span class="ow">or</span> <span class="n">high</span> <span class="n">threshold</span><span class="o">.</span>
    <span class="n">Values</span> <span class="n">which</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">exceed</span> <span class="n">either</span> <span class="n">threshold</span> <span class="n">are</span> <span class="n">flagged</span> <span class="n">good</span><span class="p">,</span>
    <span class="n">values</span> <span class="n">which</span> <span class="n">exceed</span> <span class="n">the</span> <span class="n">low</span> <span class="n">threshold</span> <span class="n">are</span> <span class="n">flagged</span> <span class="n">suspect</span><span class="p">,</span>
    <span class="ow">and</span> <span class="n">values</span> <span class="n">which</span> <span class="n">exceed</span> <span class="n">the</span> <span class="n">high</span> <span class="n">threshold</span> <span class="n">are</span> <span class="n">flagged</span> <span class="n">bad</span><span class="o">.</span>

    <span class="n">The</span> <span class="n">flag</span> <span class="ow">is</span> <span class="nb">set</span> <span class="n">at</span> <span class="n">point</span> <span class="n">n</span><span class="o">-</span><span class="mf">1.</span>

    <span class="p">:</span><span class="n">param</span> <span class="n">arr</span><span class="p">:</span> <span class="n">The</span> <span class="nb">input</span> <span class="n">array</span> <span class="n">of</span> <span class="n">values</span>
    <span class="p">:</span><span class="n">param</span> <span class="n">low_thresh</span><span class="p">:</span> <span class="n">The</span> <span class="n">low</span> <span class="n">value</span> <span class="n">threshold</span>
    <span class="p">:</span><span class="n">param</span> <span class="n">high_threshold</span><span class="p">:</span> <span class="n">The</span> <span class="n">high</span> <span class="n">threshold</span> <span class="n">value</span>
    <span class="p">:</span><span class="n">param</span> <span class="n">prev_qc</span><span class="p">:</span> <span class="n">An</span> <span class="n">array</span> <span class="n">of</span> <span class="nb">any</span> <span class="n">previous</span> <span class="n">QC</span> <span class="n">values</span> <span class="n">which</span> <span class="n">were</span> <span class="n">applied</span><span class="o">.</span>  <span class="n">The</span> <span class="n">first</span> <span class="n">element</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">to</span> <span class="n">correspond</span> <span class="n">to</span> <span class="n">the</span> <span class="n">position</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="n">element</span> <span class="n">of</span> <span class="n">arr</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">qc_flags</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">spike_check</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sea_water_temperature&#39;</span><span class="p">][:],</span> <span class="n">low_thresh</span><span class="p">,</span> <span class="n">high_thresh</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sea Water Temperature Spike Check 2016-08-17&quot;</span>
<span class="n">flagged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">qc_flags</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">qc_flags</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">make_qc_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flagged</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/QARTOD-Examples_18_1.png" src="../_images/QARTOD-Examples_18_1.png" />
</div>
<div class="section" id="rate-of-change">
<h4>Rate of Change<a class="headerlink" href="#rate-of-change" title="Permalink to this headline">¶</a></h4>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">rate_of_change_check</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
Help on function rate_of_change_check in module ioos_qartod.qc_tests.qc:

rate_of_change_check(times, arr, thresh_val, prev_qc=None)
    Checks the first order difference of a series of values to see if
    there are any values exceeding a threshold.  These are then marked as
    suspect.  It is up to the test operator to determine an appropriate
    threshold value for the absolute difference not to exceed.  Threshold may
    be expressed as a python quantities unit.  For example:
    <code class="docutils literal"><span class="pre">import</span> <span class="pre">quantities</span> <span class="pre">as</span> <span class="pre">pq</span></code>
      # more code ...
      # threshold of 2.5 per hour
      threshold = 2.5 / pq.hour
      # run the test with the new threshold
      results = rate_of_change_check(times, arr, threshold, old_qc)``

    Defaults to a rate expressed in terms of seconds if not specified.

    :param times: An array of times
    :param arr: An array of observed values
    :thresh_val: Either a float value representing a rate of change over time
                 or a quantities object represneting a value's rate of change over time
</pre>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">quantities</span> <span class="k">as</span> <span class="nn">pq</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">/</span> <span class="n">pq</span><span class="o">.</span><span class="n">hour</span> <span class="c1"># 1 °C per hour</span>
<span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num2date</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:],</span> <span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;datetime64[ms]&#39;</span><span class="p">)</span>
<span class="n">qc_flags</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">rate_of_change_check</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sea Water Temperature Rate of Change Check 2016-08-17&quot;</span>
<span class="n">flagged</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">qc_flags</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">qc_flags</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plotting</span><span class="o">.</span><span class="n">make_qc_plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">flagged</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/QARTOD-Examples_22_1.png" src="../_images/QARTOD-Examples_22_1.png" />
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">QARTOD Examples</a><ul>
<li><a class="reference internal" href="#notebook-setup">Notebook Setup</a><ul>
<li><a class="reference internal" href="#let-s-do-some-qc">Let&#8217;s do some QC!</a><ul>
<li><a class="reference internal" href="#range-check">Range Check</a></li>
<li><a class="reference internal" href="#spike-check">Spike Check</a></li>
<li><a class="reference internal" href="#rate-of-change">Rate of Change</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">IOOS QARTOD Examples</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">IOOS QARTOD Examples</a></li>
      <li>Next: <a href="../code/index.html" title="next chapter">IOOS QARTOD Code Documentation</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/examples/QARTOD Examples.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Luke Campbell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="../_sources/examples/QARTOD Examples.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>